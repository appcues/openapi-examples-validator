module.exports=function(t){var e={};function r(n){if(e[n])return e[n].exports;var a=e[n]={i:n,l:!1,exports:{}};return t[n].call(a.exports,a,a.exports,r),a.l=!0,a.exports}return r.m=t,r.c=e,r.d=function(t,e,n){r.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},r.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},r.t=function(t,e){if(1&e&&(t=r(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var a in t)r.d(n,a,function(e){return t[e]}.bind(null,a));return n},r.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return r.d(e,"a",e),e},r.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},r.p="",r(r.s=4)}([function(t,e){t.exports=require("lodash")},function(t,e){t.exports=require("jsonpath-plus")},function(t,e){t.exports=require("errno")},function(t,e){t.exports=require("json-pointer")},function(t,e,r){const n=r(0),a=r(5),o=r(6),s=r(7),i=r(1).JSONPath,c=r(2).custom.createError,u=r(8),l=u.getValidatorFactory,p=u.compileValidate,f=r(10),m=r(13),h=m.ERR_TYPE__VALIDATION,d=m.ERR_TYPE__JSON_PATH_NOT_FOUND,g=r(14).createValidationResponse,y=r(3),x="schema",P="examples",O=c(d);function b(t){return function(t,e){const r=v(e),n=function(t){return t.reduce((t,e)=>{return t[function(t){const e=i.toPathArray(t).slice(),r=e.lastIndexOf(P);return e.splice(r,e.length-r,x),i.toPathString(e)}(e)]=e,t},{})}(t),a=function(t,e){return i({json:t,path:e,resultType:"path"})}(e,f.getImplementation(e).getJsonPathToSchemas()),o=S({schemaPaths:a}),s={valid:!0,statistics:o,errors:[]};return a.forEach(t=>{!function({openapiSpec:t,createValidator:e,pathSchema:r,validationMap:n,statistics:a,validationResult:o}){const s=o.errors,c=n[r],u=function(t,e){if(!t)return null;var r;let n=i({json:e,path:t,flatten:!0,wrap:!1,resultType:"value",callback(t){if("function"!=typeof t.startsWith)return;if(!t.startsWith("#"))return;const n=t.substring(1),a=y.get(e,n);a&&(r=a)}});if(r)return r.value;return n}(c,t),l=T(r,t,!1),p=E({createValidator:e,schema:l,example:u,statistics:a}).map(t=>(c&&(t.examplePath=i.toPointer(i.toPathArray(c))),t));if(!p.length)return;o.valid=!1,s.splice(s.length-1,0,...p)}({openapiSpec:e,createValidator:r,pathSchema:t,validationMap:n,statistics:o,validationResult:s})}),s}(function(t,e){return i({json:t,path:e,resultType:"path"})}(t,f.getImplementation(t).getJsonPathToExamples()),t)}function j(t,e){const r=S({schemaPaths:t}),n=e(r);return g({errors:n,statistics:r})}function S({schemaPaths:t}){return{schemasWithExamples:t.length,examplesTotal:0,examplesWithoutSchema:0}}function E({createValidator:t,schema:e,example:r,statistics:n,filePathExample:a}){const o=[];if(e&&!r){n.schemasWithExamples--;const t=new m(h,{message:"Schema: "+JSON.stringify(e)+" is missing examples."});return o.concat(t)}if(!e&&r){n.examplesTotal++,n.examplesWithoutSchema++;const t=new m(h,{message:"Example: "+JSON.stringify(r)+" is missing a schema."});return o.concat(t())}n.examplesTotal++;const s=p(t(),e);return s(r)?o:o.concat(...s.errors.map(m.create)).map(t=>a?(t.exampleFilePath=a,t):t)}function v(t){return l(t,{allErrors:!0})}function T(t,e,r=!1){const n=function(t,e){return i({json:e,path:t,flatten:!0,wrap:!1,resultType:"value"})}(t,e);if(!r&&!n)throw new O(`Path to schema can't be found: '${t}'`,{params:{path:t}});return n}t.exports={default:b,validateFile:function(t){let e=null;try{e=JSON.parse(a.readFileSync(t,"utf-8"))}catch(t){return g({errors:[m.create(t)]})}return b(e)},validateExample:function(t,e,r){let n=null,o=null,s=null;try{n=JSON.parse(a.readFileSync(r,"utf-8")),s=JSON.parse(a.readFileSync(t,"utf-8")),o=T(e,s)}catch(t){return g({errors:[m.create(t)]})}return j([e],t=>E({createValidator:v(s),schema:o,example:n,statistics:t,filePathExample:r}))},validateExamplesByMap:function(t,e,{cwdToMappingFile:r}={}){let i=0;const c=s.sync(e,{nonull:!0}).map(e=>{let s=null,c=null;try{s=JSON.parse(a.readFileSync(e,"utf-8")),c=JSON.parse(a.readFileSync(t,"utf-8"))}catch(t){return g({errors:[m.create(t)]})}return i++,j(Object.keys(s),t=>(function(t,e,r,{cwdToMappingFile:s=!1,dirPathMapExternalExamples:i}){return n(e).entries().flatMap(([e,c])=>{let u=null;try{u=T(e,t)}catch(t){return m.create(t)}return n([c]).flatten().flatMap(e=>{let n=null;try{const t=s?o.join(i,e):e;n=JSON.parse(a.readFileSync(t,"utf-8"))}catch(t){return m.create(t)}return E({createValidator:v(t),schema:u,example:n,statistics:r,filePathExample:e})}).value()}).value()})(c,s,t,{cwdToMappingFile:r,dirPathMapExternalExamples:o.dirname(e)}).map(t=>Object.assign(t,{mapFilePath:e})))});return n.merge(c.reduce((t,e)=>t?function(t,e){return g({errors:t.errors.concat(e.errors),statistics:n.entries(t.statistics).reduce((t,[r,n])=>(t[r]=n+e.statistics[r],t),S({schemaPaths:[]}))})}(t,e):e,null),{statistics:{matchingFilePathsMapping:i}})}}},function(t,e){t.exports=require("fs")},function(t,e){t.exports=require("path")},function(t,e){t.exports=require("glob")},function(t,e,r){const n=r(1).JSONPath,a=r(3),o=r(9),s="$id",i="$..$ref",c="https://www.npmjs.com/package/openapi-examples-validator/defs.json",u="https://www.npmjs.com/package/openapi-examples-validator/schema.json";function l(t){n({path:i,json:t,callback(t,e,r){t.startsWith("#")&&(r.parent[r.parentProperty]=`${c}${t}`)}})}t.exports={getValidatorFactory:function(t,e){const r=function(t){const e={[s]:c};return n({path:i,json:t,callback(r){if(!r.startsWith("#"))return;const n=r.substring(1),o=a.get(t,n);a.set(e,n,o)}}),e}(t);return()=>{const t=new o(e);return t.addSchema(r),t}},compileValidate:function(t,e){const r=function(t,e){const r=Object.assign({},t);return r[s]=e,r}(e,u);return l(r),t.compile(r)}}},function(t,e){t.exports=require("ajv")},function(t,e,r){const n=r(11),a=r(12),o=/^3\./;t.exports={getImplementation:function(t){if("string"==typeof t.swagger)return n;if(t.openapi&&t.openapi.match(o))return a;return null}}},function(t,e){const r="$..examples.application/json",n="$..schema";t.exports={getJsonPathToExamples:function(){return r},getJsonPathToSchemas:function(){return n}}},function(t,e){const r="$..[responses,requestBody]..content.application/json.examples..[value,$ref]",n="$..[responses,requestBody]..content.application/json.schema";t.exports={getJsonPathToExamples:function(){return r},getJsonPathToSchemas:function(){return n}}},function(t,e,r){function n(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),r.push.apply(r,n)}return r}function a(t,e,r){return e in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}const o=r(0),s=r(2).code.ENOENT;class i{static create(t){const e=i.ERR_TYPE__VALIDATION,r=t.code,n=t.message,a=t.path,s=t.cause,c=r||t.type||e,u={message:n};return e===c?o.merge(u,t):(a&&o.merge(u,{params:{path:a}}),s&&o.merge(u,s)),new i(c,u)}constructor(t,e={}){Object.assign(this,function(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?n(r,!0).forEach(function(e){a(t,e,r[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):n(r).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))})}return t}({type:t},e))}}t.exports=i,i.ERR_TYPE__VALIDATION="Validation",i.ERR_TYPE__JSON_PATH_NOT_FOUND="JsonPathNotFound",i.ERR_TYPE__JS_ENOENT=s.code},function(t,e){t.exports={createValidationResponse:function({errors:t,statistics:e={}}){return{valid:!t.length,statistics:e,errors:t}}}}]);
//# sourceMappingURL=index.js.map